# HTTP API 测试文档

本文档描述了go-port-rocket项目的HTTP API测试策略和测试用例。

## 测试概述

HTTP API测试旨在验证服务器的API端点是否按预期工作。测试涵盖以下方面：

1. **基本功能测试**：验证每个API端点的基本功能
2. **错误处理**：测试API在接收到无效输入时的行为
3. **并发测试**：测试API在多个客户端同时访问时的性能
4. **认证安全测试**：测试认证机制是否正常工作
5. **边界情况测试**：测试极端情况下API的行为

## 测试文件组织

- `server_test.go`: 服务器启动、路由设置和基本功能测试
- `handlers_test.go`: API处理器单元测试
- `api_test.go`: 端到端集成测试

## 主要测试用例

### 1. 认证相关测试

- **登录API**
  - 有效凭据登录
  - 无效凭据登录
  - 空凭据登录
  - 令牌续期
  - JWT令牌验证

### 2. 任务管理测试

- **创建扫描任务**
  - 创建有效的端口扫描任务
  - 创建无目标的扫描任务（错误测试）
  - 创建无效参数的扫描任务（错误测试）
  - 创建复杂扫描任务（多目标）

- **获取任务列表**
  - 获取所有任务
  - 分页获取任务
  - 过滤任务（按状态、时间等）

- **获取单个任务**
  - 获取存在的任务
  - 获取不存在的任务（错误测试）
  - 获取已完成的任务
  - 获取正在进行的任务

- **取消任务**
  - 取消正在进行的任务
  - 取消已完成的任务（错误测试）
  - 取消不存在的任务（错误测试）

- **获取任务结果**
  - 获取已完成任务的结果
  - 获取进行中任务的结果（部分结果）
  - 获取失败任务的结果
  - 获取不存在任务的结果（错误测试）

### 3. 系统管理测试

- **系统状态**
  - 获取系统状态信息
  - 验证系统状态字段

- **系统指标**
  - 获取系统运行指标
  - 验证系统指标数据格式

### 4. 错误处理测试

- **无效请求参数**
  - 发送格式错误的JSON
  - 发送缺少必要字段的请求
  - 发送超出范围的参数值

- **资源不存在**
  - 请求不存在的任务
  - 请求不存在的端点

- **服务器错误**
  - 模拟服务器错误情况
  - 验证错误响应格式

### 5. 安全测试

- **认证绕过尝试**
  - 未提供认证令牌
  - 提供无效的认证令牌
  - 提供过期的认证令牌

- **输入验证**
  - SQL注入尝试
  - 命令注入尝试
  - XSS尝试
  - 路径遍历尝试

- **限速测试**
  - 短时间内发送大量请求
  - 验证限速机制是否正常工作

### 6. 性能测试

- **并发请求**
  - 多客户端同时发送请求
  - 验证服务器稳定性

- **大型请求**
  - 发送大型请求体
  - 验证服务器对大数据的处理能力

## 如何运行测试

### 运行全部测试

```bash
cd test/http
go test -v ./...
```

### 运行特定测试

```bash
# 运行所有处理器测试
go test -v ./... -run TestHandle

# 运行所有任务相关测试
go test -v ./... -run TestTask

# 运行认证测试
go test -v ./... -run TestAuthentication
```

### 性能测试
```bash
# 运行基准测试
go test -v ./... -run=none -bench=.
```

## 测试环境配置

测试默认使用以下配置：

- 服务器地址: localhost
- 端口: 动态分配，默认8080
- 认证: 可选（大多数测试默认禁用以简化测试）
- 存储: 内存存储（不依赖Redis）

可以通过环境变量修改测试配置：

- `TEST_SERVER_HOST`: 测试服务器主机
- `TEST_SERVER_PORT`: 测试服务器端口
- `TEST_ENABLE_AUTH`: 是否启用认证测试
- `TEST_USE_REDIS`: 是否使用Redis代替内存存储 