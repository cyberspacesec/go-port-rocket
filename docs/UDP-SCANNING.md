# UDP 端口扫描

Go-Port-Rocket 提供了强大的 UDP 端口扫描功能，能够检测开放的 UDP 服务并进行服务识别。

## UDP 扫描的挑战

UDP 协议是一种无连接的协议，这使得 UDP 端口扫描比 TCP 扫描更具挑战性：

1. **没有握手过程**：UDP 没有像 TCP 的 SYN/ACK 握手那样明确的响应机制
2. **响应不确定性**：开放的 UDP 端口可能不响应探测，或者响应可能会被防火墙过滤
3. **必须发送合适的数据包**：要准确识别 UDP 服务，需要发送服务特定的探测数据包

## 使用方法

要执行 UDP 扫描，使用 `-s udp` 选项：

```
go run main.go scan -t <目标> -p <端口范围> -s udp [选项]
```

例如：

```
go run main.go scan -t scanme.nmap.org -p 53,123,161 -s udp --service-detection
```

### 常用选项

- `--service-detection`：启用服务检测，识别开放端口上运行的服务
- `--banner-grab`：尝试获取服务的 banner 信息
- `-o <文件名>`：将结果保存到指定格式的文件（支持 HTML、JSON、XML 等）

## 支持的 UDP 服务

Go-Port-Rocket 的增强 UDP 扫描功能可以检测多种常见的 UDP 服务：

| 端口 | 服务 | 支持功能 |
|------|------|----------|
| 53 | DNS | 服务识别，版本检测 |
| 67/68 | DHCP | 服务识别 |
| 69 | TFTP | 服务识别 |
| 123 | NTP | 服务识别，版本检测 |
| 137 | NetBIOS | 服务识别 |
| 161 | SNMP | 服务识别，版本检测 |
| 500 | ISAKMP/IKE | 服务识别 |
| 514 | Syslog | 服务识别 |
| 520 | RIP | 服务识别 |
| 1900 | SSDP/UPnP | 服务识别，设备信息 |
| 5353 | mDNS | 服务识别 |

## UDP 扫描原理

Go-Port-Rocket 的 UDP 扫描使用以下策略：

1. **服务专用探测**：为每种常见 UDP 服务发送特定格式的探测数据包
2. **超时机制**：根据服务的典型响应时间设置合理的超时值
3. **响应分析**：解析服务响应，提取版本信息和服务特征
4. **状态推断**：
   - **开放**：收到 UDP 响应
   - **关闭**：收到 ICMP "端口不可达" 错误
   - **过滤**：没有响应或其他错误

## 生成 UDP 扫描报告

UDP 扫描结果可以保存为多种格式，包括：

- HTML（带交互式过滤功能）
- JSON
- XML
- 纯文本

例如，生成 HTML 报告：

```
go run main.go scan -t example.com -p 53,123,161,1900 -s udp --service-detection -o udp-scan.html
```

## 协议数据解析功能

Go-Port-Rocket 提供了先进的协议数据解析功能，可以帮助您理解和分析捕获的协议数据包。此功能目前支持以下协议：

- **NTP (UDP/123)** - 网络时间协议：解析版本、层级、轮询间隔、参考标识符和时间戳等字段
- **DNS (UDP/53)** - 域名系统：解析查询/响应标识、标志位、问题记录和资源记录信息
- **SNMP (UDP/161)** - 简单网络管理协议：解析版本、社区字符串和协议数据单元

### 使用协议解析器

当您在扫描报告中查看协议数据时，界面提供：

1. **结构化视图**：将原始十六进制数据分解为有意义的字段，每个字段带有描述性信息
2. **原始数据视图**：显示完整的十六进制数据

协议解析器的特点：

- **字段高亮显示**：不同类型的字段（如头部、数据、时间戳）使用不同颜色标识
- **交互式功能**：鼠标悬停在字段上会显示详细的字段说明
- **自适应解析**：根据数据包内容和端口自动识别和解析正确的协议

### 协议字段说明

以下是各协议中常见字段的简要说明：

#### NTP 协议字段

- **LI, VN, Mode**: 闰秒指示器、版本号和模式
- **Stratum**: 时钟的层级，指明时间源的可靠性
- **Poll**: 轮询间隔，以2的幂次方表示的秒数
- **Precision**: 本地时钟精度
- **Root Delay**: 到主参考时钟的往返延迟
- **Root Dispersion**: 相对于主参考时钟的标称误差
- **Reference ID**: 参考时钟源标识符
- **各种时间戳**: 参考时间戳、起始时间戳、接收时间戳和发送时间戳

#### DNS 协议字段

- **Transaction ID**: 标识查询/响应对的唯一ID
- **Flags**: 包含查询/响应标志、操作码、权威应答等信息
- **Questions Count**: 查询记录数量
- **Answer RRs**: 回答资源记录数量
- **Authority RRs**: 权威资源记录数量
- **Additional RRs**: 附加资源记录数量
- **查询部分**: 包含要查询的域名和记录类型
- **资源记录**: 包含回答记录、权威记录和附加记录

#### SNMP 协议字段

- **SNMP Message**: 消息头部和总长度
- **Version**: SNMP协议版本 (v1, v2c, v3)
- **Community**: 社区字符串，用于基本身份验证
- **PDU**: 协议数据单元，包含具体操作信息

## 提高 UDP 扫描准确性的建议

1. **增加超时时间**：UDP 响应可能较慢，可以使用 `-T` 选项增加超时
2. **扫描特定端口**：避免扫描大范围端口，针对性扫描可能的 UDP 服务端口
3. **留意过滤端口**：过滤状态可能表示端口被防火墙阻止，但也可能是开放端口

## 注意事项

1. UDP 扫描可能会触发 IDS/IPS 系统警报
2. 某些网络环境可能会限制或阻止 UDP 流量
3. UDP 扫描通常比 TCP 扫描需要更长的时间
4. 在生产环境中使用前，请确保您有合法权限进行扫描

## 开发者扩展 UDP 扫描

如果您是开发者，希望扩展 UDP 扫描功能，可以：

1. 在 `getUDPProbeForPort` 函数中添加新的服务探测包
2. 在 `analyzeUDPResponse` 函数中增加新的服务响应分析
3. 添加新的 UDP 服务的指纹到嵌入式指纹数据库 